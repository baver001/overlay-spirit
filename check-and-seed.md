# Диагностика и решение проблемы с оверлеями

## Проблема
Превью оверлеев не отображаются, оверлеи не применяются на фото.

## Причины
1. В БД нет данных (категории, наборы, оверлеи)
2. В R2 нет загруженных файлов изображений
3. API для доступа к файлам не настроен правильно

## Решение

### Шаг 1: Проверка текущего состояния

Откройте тестовую страницу для диагностики:
```
https://fb0350e7.loverlay.pages.dev/test-api.html
```

Нажмите кнопку **"Загрузить каталог"** и проверьте результат:
- ✅ Если показываются категории и наборы с оверлеями → переходите к Шагу 3
- ⚠️ Если наборы пустые или оверлеи отсутствуют → переходите к Шагу 2

### Шаг 2: Добавление данных через админ-панель

1. Войдите в админ-панель:
   ```
   https://fb0350e7.loverlay.pages.dev/admin
   ```

2. **Создайте категории:**
   - Перейдите в "Категории"
   - Нажмите "Add category"
   - Добавьте категории (например: "Neon", "Vintage", "Modern")

3. **Создайте наборы с оверлеями:**
   - Перейдите в "Наборы"
   - Нажмите "Add set"
   - Заполните:
     - Title: название набора
     - Category: выберите категорию
     - Paid: выберите, если платный
   - **Важно:** Загрузите JPG файлы оверлеев (кнопка "Upload Images")
   - Нажмите "Save"

4. Обновите каталог на главной странице - оверлеи должны появиться

### Шаг 3: Проверка файлов в R2

Если наборы есть, но превью не отображаются:

1. Откройте тестовую страницу
2. В разделе "Проверка файлов" введите путь из каталога
   (скопируйте значение `value` из JSON)
3. Нажмите "Проверить файл"
4. Если ошибка 404 → файлы не загружены в R2

### Шаг 4: Альтернатива - SQL seed

Если нужны тестовые данные быстро, выполните SQL:

```sql
-- Создание тестовой категории
INSERT INTO categories (id, slug, name, order_index, created_at, updated_at)
VALUES ('test-cat-1', 'neon', 'Neon Effects', 0, 1699900000000, 1699900000000);

-- Создание тестового набора
INSERT INTO overlay_sets (id, title, category_id, description, is_paid, is_active, created_by, created_at, updated_at)
VALUES ('test-set-1', 'Neon Dreams', 'test-cat-1', 'Beautiful neon overlays', 0, 1, 'admin-id', 1699900000000, 1699900000000);

-- НО: оверлеи нужно добавлять через админ-панель с загрузкой файлов!
```

**Важно:** SQL создаст структуру, но файлы оверлеев всё равно нужно загружать через админ-панель.

## Проверка работоспособности

После добавления данных:

1. Откройте главную страницу
2. В боковой панели должны появиться категории
3. Раскройте набор - должны показаться превью оверлеев (3 шт)
4. Нажмите на превью - оверлей должен добавиться
5. Загрузите фото - оверлей должен применитьс я на нём

## Технические детали

- API для файлов: `/api/files/overlays/xxx.jpg`
- R2 bucket: `loverlay`
- Формат: только JPG
- Максимальный размер: 10MB

## Контакты

Если проблема не решена, проверьте логи в Cloudflare Dashboard → Workers & Pages → loverlay → Logs

